<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN""http://www.w3.org/TR/REC-html40/loose.dtd">
<!--NewPage-->
<HTML>
<HEAD>
<!-- Generated by javadoc on Sun Oct 27 19:10:49 CET 2002 -->
<TITLE>
NTLM (NTLM Authentication in Java)
</TITLE>
<LINK REL ="stylesheet" TYPE="text/css" HREF="../../../../stylesheet.css" TITLE="Style">
</HEAD>
<SCRIPT>
function asd()
{
parent.document.title="NTLM (NTLM Authentication in Java)";
}
</SCRIPT>
<BODY BGCOLOR="white" onload="asd();">

<!-- ========== START OF NAVBAR ========== -->
<A NAME="navbar_top"><!-- --></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0">
<TR>
<TD COLSPAN=3 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_top_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;PREV CLASS&nbsp;
&nbsp;<A HREF="../../../../com/luigidragone/net/ntlm/NTLMAuthorizationHandler.html"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../../index.html" TARGET="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="NTLM.html" TARGET="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;
<SCRIPT>
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../../allclasses-noframe.html" TARGET=""><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
<A HREF="../../../../allclasses-noframe.html" TARGET=""><B>All Classes</B></A>
</NOSCRIPT>
</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;FIELD&nbsp;|&nbsp;CONSTR&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;FIELD&nbsp;|&nbsp;CONSTR&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<!-- =========== END OF NAVBAR =========== -->

<HR>
<!-- ======== START OF CLASS DATA ======== -->
<H2>
<FONT SIZE="-1">
com.luigidragone.net.ntlm</FONT>
<BR>
Class  NTLM</H2>
<PRE>
java.lang.Object
  |
  +--<B>com.luigidragone.net.ntlm.NTLM</B>
</PRE>
<HR>
<DL>
<DT>public class <B>NTLM</B><DT>extends java.lang.Object</DL>

<P>
<p>
 This class implements the Microsoft NTLM authentication protocol.
 </p>
 <p>
 NTLM is a Microsoft proprietary network authentication protocol used in many
 situations (e.g. by the Microsoft Proxy Server to authenticate a browser).
 </p>
 <p>
 It requires a JCE compatible MD4 hash algorithm implementation and
 a DES with no-padding ECB cipher to compute the requested value. <br>
 An open source JCE compatible library is Cryptix JCE and it is available
 <a href="http://www.cryptix.org/">here</a>. We are assuming that the JCE provider
 is correctly installed and configured. Notice that the Sun JCE implementation
 proviedes the DES cipher but doesn't provide the MD4 hashing.
 </p>
 To perform an authentication the following information are needed:
 <ul>
 <li>the host name (with its own domain);</li>
 <li>the user name (with its own domain);</li>
 <li>the user password.</li>
 </ul>
 Alternatively, the user password can be replaced with its Lan Manager and
 NT hashed versions. On a Windows system these data can be collected in the
 registry, otherwise they can be extracted from a SAMBA password file.<br>
 Notice that the host and user domain could not be the same.
 </p>
 <p>
 To start an NTLM authentication procedure (e.g. with a proxy server) build a
 request message calling <A HREF="../../../../com/luigidragone/net/ntlm/NTLM.html#formatRequest(java.lang.String, java.lang.String)"><CODE>formatRequest</CODE></A>
 and send it to the server.<br>
 Once the challenge packet has been correctly received extract from it the nonce
 with <A HREF="../../../../com/luigidragone/net/ntlm/NTLM.html#getNonce(byte[])"><CODE>getNonce</CODE></A> function and use it to compute the
 reply and build the response message with
 <A HREF="../../../../com/luigidragone/net/ntlm/NTLM.html#formatResponse(java.lang.String, java.lang.String, java.lang.String, byte[], byte[], byte[])"><CODE>formatResponse</CODE></A>
 method and send it back to the server.<br>
 Repeat the previous steps until the server authenticates the client's identity
 or a large number of retries has been made. The check of a successful authentication
 is protocol specific (e.g. code 200 in HTTP), thus it is not performed by this component.
 </p>
 <p>
 We want to access to the page <code>http://www.server.com/page.html</code>
 through an NTLM proxy <code>proxy.domain.com</code> that accepts connection on
 port 80.<br>
 We access to proxy from host <code>HOSTDOMAIN\\HOST<code> with the user
 <code>USERDOMAIN\\user</code> (password <code>"1234567890"</code>).<br>
 As first step we open a socket connection to proxy server and set up the
 required object. Notice that we use a keep-alive connection, because NTLM
 authentication is connection based and the connection must be alive through the
 whole process.<br>
 <pre>
     Socket s = new Socket("proxy.domain.com", 80);
     s.setKeepAlive(true);
     InputStream is = s.getInputStream();
     OutputStream os = s.getOutputStream();
     BufferedReader r = new BufferedReader(new InputStreamReader(is));
     BufferedWriter w = new BufferedWriter(new OutputStreamWriter(os));

     String host = "HOST";
     String hostDomain = "HOSTDOMAIN";
     String user = "user";
     String userDomain = "USERDOMAIN";
     String password = "1234567890";
 </pre>
 Then, we format a request message and send it in a HTTP compliant GET message.<br>
 <pre>
     byte[] fstMsg = NTLM.formatRequest(host, hostDomain);
     byte[] fstMsg64 = Codecs.base64Encode(fstMsg);
     System.out.println("NTLM Request Packet: " + new String(fstMsg64));

     w.write("GET http://www.server.com/page.html HTTP/1.0\n");
     w.write("Host: www.server.com\n");
     w.write("Proxy-Connection: Keep-Alive\n");
     w.write("Proxy-Authorization: NTLM " + new String(fstMsg64) + "\n\n");
     w.flush();
     System.out.println("First Message Sent");
 </pre>
 We wait for the server response and we parse it to extract the nonce.<br>
 <pre>
     String resp = "";
     int contentLength = 0;
     while((line = r.readLine()) != null)
       if(line.length() == 0)
         break;
       if(line.startsWith("Content-Length"))
         contentLength = Integer.parseInt(line.substring(line.indexOf(":") + 1).trim());
       else if(line.startsWith("Proxy-Authenticate"))
         resp = line.substring(line.indexOf(":") + 1).trim();
     r.skip(contentLength);
     System.out.println("Second Message Received");
     System.out.println("Content Length: " + contentLength);
     System.out.println("Proxy-Authenticate: " + resp);
     resp = resp.substring(resp.indexOf(" ")).trim();
     System.out.println("NTLM Chellange Packet: " + resp);
     resp = Codecs.base64Decode(resp);
     byte[] sndMsg = resp.getBytes();
     byte[] nonce = NTLM.getNonce(sndMsg);
 </pre>
 With the nonce collected in the previous step we create a response message.<br>
 <pre>
     byte[] trdMsg = NTLM.formatResponse(host, user, userDomain,
     	NTLM.computeLMPassword(password), NTLM.computeNTPassword(password),
     	nonce);
     System.out.println(trdMsg.length);
     byte[] trdMsg64 = Codecs.base64Encode(trdMsg);
     System.out.println("NTLM Response Packet: " + new String(trdMsg64));
 </pre>
 We sent the message to the server.<br>
 <pre>
     w.write("GET http://www.server.com/page.html HTTP/1.0\n");
     w.write("Proxy-Connection: Keep-Alive\n");
     w.write("Host: www.server.com\n");
     w.write("Proxy-Authorization: NTLM " + new String(trdMsg64) + "\n\n");
     w.flush();
     System.out.println("Third Message Sent");
 </pre>
 Finally we wait the server reply.<br>
 <pre>
     System.out.println("Server response: " + r.readLine());
 </pre>
 If the reply is like <code>"HTTP/1.0 200 OK"</code> it has worked fine, else
 the server response is containing a new nonce.
 </p>
 <p>
 Notice that despite the computing of hashed passwords and of nonce response is
 exactly the same of the SMB authentication protocol, the message format is slightly
 different. <br>
 Therefore, the methods <A HREF="../../../../com/luigidragone/net/ntlm/NTLM.html#computeLMPassword(java.lang.String)"><CODE>computeLMPassword</CODE></A>,
 <A HREF="../../../../com/luigidragone/net/ntlm/NTLM.html#computeNTPassword(java.lang.String)"><CODE>computeNTPassword</CODE></A> and
 <A HREF="../../../../com/luigidragone/net/ntlm/NTLM.html#computeNTLMResponse(byte[], byte[], byte[], byte[], byte[])"><CODE>computeNTLMResponse</CODE></A>
 can be used to perform a SMB authentication too.
 </p>
 <p>
 This implementation is based on:
 <ul>
 <li>the reverse engineering of the NTLM protocol made by Ronald Tschal&auml;r
 and available <a href="http://www.innovation.ch/java/ntlm.html">here</a>;</li>
 <li>the documentation about NTLM provided with <a href="http://www.atstake.com/research/lc3/">
 L0phtCrack 1.5</a>;</li>
 <li>the &quot;Handbook of Applied Cryptography&quot;, freely available
 <a href="http://www.cacr.math.uwaterloo.ca/hac/">here</a>;</li>
 <li>the C source code of NTLM library in the <a href="http://www.samba.org/">
 SAMBA Project</a>.</li>
 </ul>
 Nevertheless, because there isn't any official protocol specification publicly
 available there is any warranty that code works correctly and that it is
 conforming to Microsoft NTLM protocol.
 </p>
 <p>
 For implementation reasons only the public members perform argument consistency
 checks. The public members also catch and hide every exceptions that can be
 throwed (even though interfaces specify otherwise).
 </p>
<P>

<P>
<DL>
<DT><B>Version:</B><DD>1.0.1</DD>
</DD>
<DT><B>Author:</B><DD>Luigi Dragone (<a href="mailto:luigi@luigidragone.com">luigi@luigidragone.com</a>)</DD>
</DD>
<DT><B>See Also:</B><DD><a href="http://www.innovation.ch/java/ntlm.html">NTLM Authentication Scheme for HTTP</a>, 
<a href="ftp://ftp.samba.org/pub/samba/docs/textdocs/ENCRYPTION.txt">LanMan and NT Password Encryption in Samba 2.x</a>, 
<a href="http://www.cacr.math.uwaterloo.ca/hac/">&quot;Handbook of Applied Cryptography&quot;</a>, 
<a href="http://java.sun.com/products/jce/">JCE</a>, 
<a href="http://www.cryptix.org/">Cryptix</a></DL>
<HR>

<P>
<!-- ======== NESTED CLASS SUMMARY ======== -->


<!-- =========== FIELD SUMMARY =========== -->


<!-- ======== CONSTRUCTOR SUMMARY ======== -->


<!-- ========== METHOD SUMMARY =========== -->

<A NAME="method_summary"><!-- --></A>
<TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>Method Summary</B></FONT></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;byte[]</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../com/luigidragone/net/ntlm/NTLM.html#computeLMPassword(java.lang.String)">computeLMPassword</A></B>(java.lang.String&nbsp;password)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Computes the Lan Manager hashed version of a password.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../com/luigidragone/net/ntlm/NTLM.html#computeNTLMResponse(byte[], byte[], byte[], byte[], byte[])">computeNTLMResponse</A></B>(byte[]&nbsp;lmPassword,
                    byte[]&nbsp;ntPassword,
                    byte[]&nbsp;nonce,
                    byte[]&nbsp;lmResponse,
                    byte[]&nbsp;ntResponse)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 Computes the NTLM response to the nonce based on the supplied hashed passwords.
 </TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;byte[]</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../com/luigidragone/net/ntlm/NTLM.html#computeNTPassword(java.lang.String)">computeNTPassword</A></B>(java.lang.String&nbsp;password)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Computes the NT hashed version of a password.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;byte[]</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../com/luigidragone/net/ntlm/NTLM.html#formatRequest(java.lang.String, java.lang.String)">formatRequest</A></B>(java.lang.String&nbsp;host,
              java.lang.String&nbsp;hostDomain)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 Builds a request message for the host of the specified domain that can be send
 to the server to start the NTLM protocol.
 </TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;byte[]</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../com/luigidragone/net/ntlm/NTLM.html#formatResponse(java.lang.String, java.lang.String, java.lang.String, byte[], byte[], byte[])">formatResponse</A></B>(java.lang.String&nbsp;host,
               java.lang.String&nbsp;user,
               java.lang.String&nbsp;userDomain,
               byte[]&nbsp;lmPassword,
               byte[]&nbsp;ntPassword,
               byte[]&nbsp;nonce)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 Builds the nonce response message.
 </TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;byte[]</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../com/luigidragone/net/ntlm/NTLM.html#getNonce(byte[])">getNonce</A></B>(byte[]&nbsp;msg)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 Extracts from the server challenge response the nonce required to perform
 the authentication.
 </TD>
</TR>
</TABLE>
&nbsp;<A NAME="methods_inherited_from_class_java.lang.Object"><!-- --></A>
<TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#EEEEFF" CLASS="TableSubHeadingColor">
<TD><B>Methods inherited from class java.lang.Object</B></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE>equals, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</CODE></TD>
</TR>
</TABLE>
&nbsp;
<P>

<!-- ============ FIELD DETAIL =========== -->


<!-- ========= CONSTRUCTOR DETAIL ======== -->


<!-- ============ METHOD DETAIL ========== -->

<A NAME="method_detail"><!-- --></A>
<TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=1><FONT SIZE="+2">
<B>Method Detail</B></FONT></TD>
</TR>
</TABLE>

<A NAME="computeLMPassword(java.lang.String)"><!-- --></A><H3>
computeLMPassword</H3>
<PRE>
public static byte[] <B>computeLMPassword</B>(java.lang.String&nbsp;password)
                                throws java.lang.IllegalArgumentException,
                                       javax.crypto.NoSuchPaddingException,
                                       java.security.NoSuchAlgorithmException</PRE>
<DL>
<DD>Computes the Lan Manager hashed version of a password.
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>password</CODE> - the user password
<DT><B>Returns:</B><DD>the Lan Manager hashed version of the password in a 16-bytes array
<DT><B>Throws:</B>
<DD><CODE>java.lang.IllegalArgumentException</CODE> - if the supplied password is null
<DD><CODE>javax.crypto.NoSuchPaddingException</CODE> - if there isn't any suitable padding method
<DD><CODE>java.security.NoSuchAlgorithmException</CODE> - if there isn't any suitable cipher algorithm</DL>
</DD>
</DL>
<HR>

<A NAME="computeNTPassword(java.lang.String)"><!-- --></A><H3>
computeNTPassword</H3>
<PRE>
public static byte[] <B>computeNTPassword</B>(java.lang.String&nbsp;password)
                                throws java.lang.IllegalArgumentException,
                                       java.security.NoSuchAlgorithmException</PRE>
<DL>
<DD>Computes the NT hashed version of a password.
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>password</CODE> - the user password
<DT><B>Returns:</B><DD>the NT hashed version of the password in a 16-bytes array
<DT><B>Throws:</B>
<DD><CODE>java.lang.IllegalArgumentException</CODE> - if the supplied password is null
<DD><CODE>java.security.NoSuchAlgorithmException</CODE> - if there isn't any suitable cipher algorithm</DL>
</DD>
</DL>
<HR>

<A NAME="computeNTLMResponse(byte[], byte[], byte[], byte[], byte[])"><!-- --></A><H3>
computeNTLMResponse</H3>
<PRE>
public static void <B>computeNTLMResponse</B>(byte[]&nbsp;lmPassword,
                                       byte[]&nbsp;ntPassword,
                                       byte[]&nbsp;nonce,
                                       byte[]&nbsp;lmResponse,
                                       byte[]&nbsp;ntResponse)
                                throws java.lang.IllegalArgumentException,
                                       javax.crypto.NoSuchPaddingException,
                                       java.security.NoSuchAlgorithmException</PRE>
<DL>
<DD><p>
 Computes the NTLM response to the nonce based on the supplied hashed passwords.
 </p>
 <p>
 If the hashed password are not available they can be computed from the cleartext password
 by the means of <A HREF="../../../../com/luigidragone/net/ntlm/NTLM.html#computeLMPassword(java.lang.String)"><CODE>computeLMPassword</CODE></A> and
 <A HREF="../../../../com/luigidragone/net/ntlm/NTLM.html#computeNTPassword(java.lang.String)"><CODE>computeNTPassword</CODE></A> methods.
 </p>
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>lmPassword</CODE> - a 16-bytes array containing the Lan Manager hashed password<DD><CODE>ntPassword</CODE> - a 16-bytes array containing the Lan Manager hashed password<DD><CODE>nonce</CODE> - a 8-bytes array representing the server's nonce<DD><CODE>lmResponse</CODE> - a 24-bytes array that will contain the Lan Manager response after the method invocation<DD><CODE>ntResponse</CODE> - a 24-bytes array that will contain the NT response after the method invocation
<DT><B>Throws:</B>
<DD><CODE>java.lang.IllegalArgumentException</CODE> - if a parameter has an illegal size
<DD><CODE>javax.crypto.NoSuchPaddingException</CODE> - if there isn't any suitable padding method
<DD><CODE>java.security.NoSuchAlgorithmException</CODE> - if there isn't any suitable cipher algorithm</DL>
</DD>
</DL>
<HR>

<A NAME="formatRequest(java.lang.String, java.lang.String)"><!-- --></A><H3>
formatRequest</H3>
<PRE>
public static byte[] <B>formatRequest</B>(java.lang.String&nbsp;host,
                                   java.lang.String&nbsp;hostDomain)
                            throws java.io.IOException</PRE>
<DL>
<DD><p>
 Builds a request message for the host of the specified domain that can be send
 to the server to start the NTLM protocol.
 </p>
 <p>
 The returned message should be encoded according to protocol specific rules
 (e.g. base 64 encoding).<br>
 The message format is discussed <a href="http://www.innovation.ch/java/ntlm.html">here</a>.
 </p>
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>host</CODE> - the name of the host that is authenticating<DD><CODE>hostDomain</CODE> - the name of the domain to which the host belongs
<DT><B>Returns:</B><DD>the request message to send to server to open an authentication procedure
<DT><B>Throws:</B>
<DD><CODE>java.io.IOException</CODE> - if an error occurs during the message formatting<DT><B>See Also:</B><DD><a href="http://www.innovation.ch/java/ntlm.html">NTLM Authentication Scheme for HTTP</a></DL>
</DD>
</DL>
<HR>

<A NAME="getNonce(byte[])"><!-- --></A><H3>
getNonce</H3>
<PRE>
public static byte[] <B>getNonce</B>(byte[]&nbsp;msg)
                       throws java.lang.IllegalArgumentException</PRE>
<DL>
<DD><p>
 Extracts from the server challenge response the nonce required to perform
 the authentication.
 </p>
 <p>
 The received message should be decoded according to protocol specific rules
 (e.g. base 64 encoding).<br>
 The message format is discussed <a href="http://www.innovation.ch/java/ntlm.html">here</a>.
 </p>
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>msg</CODE> - a byte array containing the server challenge message
<DT><B>Throws:</B>
<DD><CODE>java.lang.IllegalArgumentException</CODE> - if a parameter has an illegal size<DT><B>See Also:</B><DD><a href="http://www.innovation.ch/java/ntlm.html">NTLM Authentication Scheme for HTTP</a></DL>
</DD>
</DL>
<HR>

<A NAME="formatResponse(java.lang.String, java.lang.String, java.lang.String, byte[], byte[], byte[])"><!-- --></A><H3>
formatResponse</H3>
<PRE>
public static byte[] <B>formatResponse</B>(java.lang.String&nbsp;host,
                                    java.lang.String&nbsp;user,
                                    java.lang.String&nbsp;userDomain,
                                    byte[]&nbsp;lmPassword,
                                    byte[]&nbsp;ntPassword,
                                    byte[]&nbsp;nonce)
                             throws java.lang.IllegalArgumentException,
                                    java.io.IOException,
                                    java.security.NoSuchAlgorithmException,
                                    javax.crypto.NoSuchPaddingException</PRE>
<DL>
<DD><p>
 Builds the nonce response message.
 </p>
 <p>It requires the Lan Manager and NT hashed
 version of user password, that can be computed from the cleartext version by
 <A HREF="../../../../com/luigidragone/net/ntlm/NTLM.html#computeNTPassword(java.lang.String)"><CODE>computeNTPassword</CODE></A> and
 <A HREF="../../../../com/luigidragone/net/ntlm/NTLM.html#computeNTLMResponse(byte[], byte[], byte[], byte[], byte[])"><CODE>computeNTLMResponse</CODE></A>,
 and the nonce obtained from the server by <A HREF="../../../../com/luigidragone/net/ntlm/NTLM.html#getNonce(byte[])"><CODE>getNonce</CODE></A>.<br>
 The returned message should be encoded according to protocol specific rules
 (e.g. base 64 encoding).<br>
 The message format is discussed <a href="http://www.innovation.ch/java/ntlm.html">here</a>.
 </p>
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>host</CODE> - the name of the host that is authenticating<DD><CODE>user</CODE> - the name of the user<DD><CODE>userDomain</CODE> - the name of the domain to which the user belongs<DD><CODE>lmPassword</CODE> - a 16-bytes array containing the Lan Manager hashed password<DD><CODE>ntPassword</CODE> - a 16-bytes array containing the NT hashed password<DD><CODE>nonce</CODE> - a 8-byte array containing the nonce sent by server to reply to the request message
<DT><B>Returns:</B><DD>the challenge response message to send to server to complete the authentication procedure
<DT><B>Throws:</B>
<DD><CODE>java.io.IOException</CODE> - if an error occurs during the message formatting
<DD><CODE>java.lang.IllegalArgumentException</CODE> - if a parameter has an illegal size
<DD><CODE>javax.crypto.NoSuchPaddingException</CODE> - if there isn't any suitable padding method
<DD><CODE>java.security.NoSuchAlgorithmException</CODE> - if there isn't any suitable cipher algorithm<DT><B>See Also:</B><DD><a href="http://www.innovation.ch/java/ntlm.html">NTLM Authentication Scheme for HTTP</a></DL>
</DD>
</DL>
<!-- ========= END OF CLASS DATA ========= -->
<HR>

<!-- ========== START OF NAVBAR ========== -->
<A NAME="navbar_bottom"><!-- --></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0">
<TR>
<TD COLSPAN=3 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_bottom_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;PREV CLASS&nbsp;
&nbsp;<A HREF="../../../../com/luigidragone/net/ntlm/NTLMAuthorizationHandler.html"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../../index.html" TARGET="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="NTLM.html" TARGET="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;
<SCRIPT>
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../../allclasses-noframe.html" TARGET=""><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
<A HREF="../../../../allclasses-noframe.html" TARGET=""><B>All Classes</B></A>
</NOSCRIPT>
</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;FIELD&nbsp;|&nbsp;CONSTR&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;FIELD&nbsp;|&nbsp;CONSTR&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<!-- =========== END OF NAVBAR =========== -->

<HR>

</BODY>
</HTML>
